<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FOTA — Direct Neon Uploader</title>
<style>
:root{
  --bg:#05070f; --panel:#0b1020; --fg:#eaf2ff; --bd:#1a2340;
  --a:#00e0ff; --b:#7cffb2; --glow:0 0 40px rgba(0,224,255,.35), 0 0 60px rgba(124,255,178,.25);
}
*{box-sizing:border-box}
body{
  margin:0; min-height:100vh; display:grid; place-items:center; padding:28px;
  background:
    radial-gradient(60% 80% at 80% -10%, rgba(0,224,255,.12), transparent 60%),
    radial-gradient(50% 70% at 10% 110%, rgba(124,255,178,.10), transparent 60%),
    var(--bg);
  color:var(--fg); font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
}
.card{
  width:min(980px,100%); background:linear-gradient(180deg,rgba(255,255,255,.03),transparent), var(--panel);
  border:1px solid var(--bd); border-radius:22px; padding:22px 22px 18px; box-shadow:0 20px 60px rgba(0,0,0,.5);
  backdrop-filter: blur(6px);
}
.top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:12px}
.badge{
  width:40px;height:40px;border-radius:10px;border:1px solid var(--bd);
  background:linear-gradient(135deg,var(--a),var(--b));
  box-shadow:var(--glow);
}
h1{margin:0;font-size:22px;letter-spacing:.2px}
.row{display:grid;grid-template-columns:1.1fr .9fr;gap:12px;margin-top:8px}
label.txt{display:flex;flex-direction:column;gap:8px;font-size:13px}
input[type="text"]{
  background:#0c1428;border:1px solid var(--bd);border-radius:12px;color:var(--fg);
  padding:12px;font-size:15px;outline:none;transition:.15s;
}
input[type="text"]:focus{border-color:var(--a); box-shadow:0 0 0 3px rgba(0,224,255,.15)}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{
  padding:10px 14px;border-radius:999px;border:1px solid var(--bd);background:#0b1326;cursor:pointer;color:#bcd3ff;font-size:13px;user-select:none
}
.chip.active{border-color:transparent;color:#071226;background:linear-gradient(90deg,var(--a),var(--b));font-weight:800;box-shadow:var(--glow)}
.zone{
  display:grid;grid-template-columns:1fr;gap:10px;border:1.5px dashed #2a365a;border-radius:16px;padding:16px;background:#0b1324;min-height:110px;place-content:center;text-align:center;color:#a9b7d9
}
.zone.drag{border-color:var(--a);color:#e2f7ff;background:#0c1a2e}
.pill{display:flex;gap:10px;align-items:center}
input[type="file"]{color:#cfe8ff}
.hint{color:#8aa0c9;font-size:12px;text-align:right}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.btn{
  padding:12px 16px;border-radius:12px;border:1px solid var(--bd);background:#0e1830;color:#eaf2ff;cursor:pointer;font-weight:700;
}
.btn.primary{border:0;background:linear-gradient(90deg,var(--a),var(--b));color:#071226;box-shadow:var(--glow)}
.btn:disabled{opacity:.6;cursor:not-allowed}
.progress{height:12px;background:#0a1120;border-radius:999px;border:1px solid var(--bd);overflow:hidden}
.bar{height:100%;width:0%;background:linear-gradient(90deg,var(--a),var(--b));transition:width .2s}
.iframe-wrap{border:1px solid var(--bd);border-radius:14px;overflow:hidden;background:#081025}
#sink{width:100%;height:240px;background:#091225}
.kbd{font-size:12px;color:#8aa0c9}
</style>
</head>
<body>
<div class="card">
  <div class="top">
    <div class="logo"><div class="badge"></div><h1>FOTA Direct Uploader</h1></div>
    <div class="chips" id="modes">
      <div class="chip active" data-mode="single">Single</div>
      <div class="chip" data-mode="zip">ZIP</div>
    </div>
  </div>

  <form id="f" target="sink" method="post" enctype="multipart/form-data">
    <div class="row">
      <label class="txt">Raspberry Pi IP
        <input id="ip" type="text" placeholder="192.168.137.187" required />
      </label>
      <label class="txt">Version (ZIP)
        <input id="version" name="version" type="text" placeholder="1.4.0" />
      </label>
    </div>

    <input type="hidden" id="mode" name="mode" value="single" />

    <div class="row" style="align-items:start">
      <div class="txt">
        <div class="zone" id="zone">
          <div>Drop file here</div>
          <div class="pill"><input id="file" name="file" type="file" accept=".py,.zip" required /></div>
          <div class="hint" id="hint">&nbsp;</div>
        </div>
      </div>
      <div class="txt grid2">
        <div class="progress"><div class="bar" id="bar"></div></div>
        <div style="display:flex;gap:10px;justify-content:flex-end">
          <button type="button" class="btn" id="open">Endpoint</button>
          <button type="submit" class="btn primary" id="send">Upload</button>
        </div>
        <div class="iframe-wrap" style="grid-column:1/-1"><iframe id="sink" name="sink" title="Response"></iframe></div>
        <div class="kbd" style="grid-column:1/-1">응답은 위 창에 표시됩니다.</div>
      </div>
    </div>
  </form>
</div>

<script>
const $=id=>document.getElementById(id);
const modes=modes; const mode=mode; const ip=ip; const ver=version;
const fileEl=file; const zone=zone; const hint=hint; const bar=bar; const frm=f; const openBtn=open;

// mode chips
modes.addEventListener('click',e=>{
  const c=e.target.closest('.chip'); if(!c) return;
  modes.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
  c.classList.add('active'); mode.value=c.dataset.mode;
});

// drop
['dragenter','dragover'].forEach(ev=>zone.addEventListener(ev,e=>{e.preventDefault(); zone.classList.add('drag');}));
['dragleave','drop'].forEach(ev=>zone.addEventListener(ev,e=>{e.preventDefault(); zone.classList.remove('drag');}));
zone.addEventListener('drop',e=>{
  const f=e.dataTransfer?.files?.[0]; if(!f) return;
  const dt=new DataTransfer(); dt.items.add(f); fileEl.files=dt.files; updateFileUI(f);
});
fileEl.addEventListener('change',e=>{
  const f=e.target.files?.[0]; if(f) updateFileUI(f);
});

function updateFileUI(f){
  const isZip=/\.zip$/i.test(f.name);
  const newMode=isZip?'zip':'single';
  if(newMode!==mode.value){
    mode.value=newMode;
    modes.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.mode===newMode));
  }
  const m=f.name.match(/(\d+\.\d+\.\d+)/); if(m && !ver.value) ver.value=m[1];
  hint.textContent=(isZip?'ZIP':'Single')+' · '+f.name+' · '+Math.round(f.size/1024)+' KB';
}

// endpoint open
openBtn.addEventListener('click',()=>{
  const host=ip.value.trim(); if(!host){ alert('IP'); return; }
  window.open('http://'+host+':8080/upload','_blank');
});

// submit → set action to Pi; progress bar anim fake (since native form)
frm.addEventListener('submit',e=>{
  const host=ip.value.trim(); if(!host){ e.preventDefault(); alert('IP'); return; }
  frm.action='http://'+host+':8080/upload';
  bar.style.transition='none'; bar.style.width='0%'; void bar.offsetWidth;
  bar.style.transition='width .6s'; bar.style.width='30%';
  // bump later
  setTimeout(()=>bar.style.width='70%',800);
  // when iframe loads (response), fill bar
  sink.addEventListener('load',()=>{ bar.style.width='100%'; }, {once:true});
});
</script>
</body>
</html>
